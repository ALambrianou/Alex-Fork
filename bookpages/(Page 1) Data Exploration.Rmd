---
jupyter:
  jupytext:
    text_representation:
      extension: .Rmd
      format_name: rmarkdown
      format_version: '1.2'
      jupytext_version: 1.15.2
  kernelspec:
    display_name: Python 3 (ipykernel)
    language: python
    name: python3
---

# Airbnb Datascience Project


## Introduction


#### Data sourcing
The Dataset for this project contains listing data for Airbnb for London, up to September 2022. The dataset used is a precleaned dataset from Kaggle, that was sourced from http://insideairbnb.com.

#### Cleaning
The dataset comes in a relatively clean state, as such cleaning is a relatively straight forward task with minor alterations made mostly for clarity.  
(For specifics please see go to the function and examine the function "data_setup()" found in "\projtools\data_tools.py")  

Overview  
-Setting the 'id' column to the pandas index  
-Renaming columns for clarity  
-Removing special characters  
-Dropping unnecessary columns  
-Converts prices from $ to £
-Gives the bedrooms column 0 values
-Reorders columns to group related data
-Adding column host_listings_group

#### Description
The columns contain data pertaining to the property, host, location and reviews. Please see the table below for a list of the relevant columns and their corresponding explanation. There are 48 Columns and 69351 rows/entries.


### Columns Descriptions

| Column                                  | Description                                               |
|-----------------------------------------|-----------------------------------------------------------|
| id (Index)                              | The listing identification number                          |
| host_id                                 | AirBnB host identification number                          |
| host_name                               | Host name                                                  |
| host_since                              | Host join date                                             |
| host_location                           | Host Location                                             |
| host_about                              | Host description                                          |
| host_response_time                      | Host response time                                        |
| host_response_rate                      | Host response rate                                        |
| host_acceptance_rate                    | Host acceptance rate                                      |
| host_is_superhost                       | Host is superhost true/false                               |
| host_listings_group                     | Host number of listings grouped                            |
| host_listings_count                     | Number of active listings (everywhere)                     |
| host_lifetime_listings_count            | Number of all-time listings (everywhere)                   |
| host_verifications                      | Host verification methods                                 |
| host_identity_verified                  | Host is a verified host                                    |
| calculated_host_listings_count          | Host listings in London                                   |
| calculated_host_listings_count_entire_homes | Total count of entire home listings London            |
| calculated_host_listings_count_private_rooms | Total count of private room listings London          |
| calculated_host_listings_count_shared_rooms | Total count of shared room listings London             |
| name                                    | Property listing                                           |
| description                             | Listing description                                        |
| neighbourhood_location                  | London borough                                             |
| neighbourhood_description               | Host description of the area                               |
| latitude                                | Listing latitude                                           |
| longitude                               | Listing longitude                                          |
| property_type                           | Property type                                              |
| room_type                               | Room type                                                  |
| accommodates                            | Maximum number of guests                                   |
| bathrooms_text                          | Number of bathrooms (Slightly more specific due to variance)|
| bedrooms                                | Number of bedrooms                                         |
| beds                                    | Number of beds                                             |
| amenities                               | Host's list of amenities                                   |
| price_per_night_$                       | Price per night in dollars                                 |
| minimum_nights                          | Minimum required booking duration                          |
| maximum_nights                          | Maximum allowed booking duration                           |
| minimum_nights_avg_bookings             | Average minimum nights booked                              |
| maximum_nights_avg_bookings             | Average maximum nights booked                              |
| instant_bookable                        | Instant bookable? True or False                           |
| number_of_reviews                       | Number of total reviews                                    |
| review_scores_rating                    | Overall review rating                                      |
| review_scores_accuracy                  | Accuracy review rating                                     |
| review_scores_cleanliness               | Cleanliness review rating                                  |
| review_scores_checkin                   | Check-in review rating                                     |
| review_scores_communication             | Communication review rating                               |
| review_scores_location                  | Location review rating                                     |
| review_scores_value                     | Value review rating                                        |
| reviews_per_month                       | Number of reviews per month                                |
| number_of_review_imgs                   | Number of review images                                    |
| first_review                            | First review date                                          |
| last_review                             | The most recent review date                                |


```{python}
#Run these cells to get started
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
from projtools import data_tools as dt
from projtools import plotting_tools as pt 
```

```{python}
#Full pandas dataframe
data = dt.data_setup()
data.head()
```

### Descriptive Stats

```{python}
data.describe()
```

### Standout Stats

1) **Hosting Listings** - There is a large difference between the maximum and the upper quartile, suggesting a small number of hosts with a high concentration of listings.  
      
    {cite}`temperton_2020`, states data compiled by London City Hall in May 2019 indicated that 1% of Airbnb hosts were responsible for 15% of active listings on Airbnb. This dataset is from September 2022, so we can compare this figure to see if there has been a change.
  
2) **Calculated Host Listings Count** - There is a significant difference between the maximum number of listings and the maximum number of properties.  
{cite}`temperton_2020`, "80,770 properties in London were listed on Airbnb." This dataset has 69351 entries which suggests that there has been a drop in listings on the platform since the report was made. Airbnb note that each listing does not represent a property as you can have multiple rooms listed in a single property. Therefore Airbnb claim that the total number of properties on the platform is lower than the London City Council's estimates.

3) 
    a. **Maximum Nights** - Although London imposes a 90-day limit on stays, the data indicates that the second quartile for maximum nights is exactly one year.  
    b. **Maximum Nights Average Bookings** - The first quartile appears to be 90 days, but the second and third quartiles are just over three years.   
    Data compiled by Camden Council and cited by {cite}`temperton_2020` reveals that, of the 7,100 whole properties listed on platforms like Airbnb and Booking.com in 2019, 48% exceeded the 90-day legal limit.

4) **Price per night $** - The mean price was 165.66, however the 1st and 2nd quartiles were 51.41 and 93.48 respectively.  
According to City Hall, properties in London listed on short-term rental sites rake in an average of £109 per night. Were they rented out to long-term tenants, they would make £58 per night {cite}`temperton_2020`. This data seems to dispute this. 




### Further things to explore from "Airbnb has devoured London – and here’s the data that proves it" Temperton 2020

5) Westminster is the most affected area in london by short-term rentals as of January 2020 there were 8,836 short-term rental listings in the borough.

```{python}
data['neighbourhood_location'].value_counts().head(5)
```

This statement is corroborated by the data, while there are less rentals in Westminster than in January 2020 Westminster is the most heavily affected borough.


# Initial Exploration





### 1. Host listing concentration

In 2019 1% of hosts accounted for 15% of listings.  
What percentage of listings do the top 1% of hosts account for in 2022?

```{python}
# Method 2 using host_id frequency count in the dataset

# Counting how many times each host_id appears in the data to get a listings count based on the London data.
host_listing_counts_london = data['host_id'].value_counts()

# Calculate total listings
total_listings = len(data)

# Identify the number of listings to be in top 1% of hosts
top_1_percent_threshold = host_listing_counts_london.quantile(0.99)

# Filter the hosts that are in the top 1%
top_1_percent_hosts_listings = host_listing_counts_london[host_listing_counts_london >= top_1_percent_threshold]

# Calculate total listings accounted for by the top 1% and calculate this as a percentage
total_listings_top_1_percent_hosts = top_1_percent_hosts_listings.sum()
percent_listings_top_1 = (total_listings_top_1_percent_hosts / total_listings) * 100

# Plot the distribution of listings per host

#Binning data
bins = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 20, 50, 100, float('inf')]
bin_labels = ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10-20', '21-50', '51-100', '101+']
binned_counts = pd.cut(host_listing_counts_london, bins, labels=bin_labels, right=False)
binned_counts_value = binned_counts.value_counts().sort_index()

# Plot the binned data
plt.figure(figsize=(12, 6))
plt.bar(binned_counts_value.index, binned_counts_value.values, width=0.5, edgecolor="black")
plt.xlabel('Number of Listings')
plt.ylabel('Number of Hosts')
plt.title('Distribution of Listings Among Hosts')
plt.yscale('log')
plt.show()

print(f"Over {top_1_percent_threshold} listings puts a host in the Top 1% of Hosts by number of listings")
print(f"The max number of listings for a single host is : {top_1_percent_hosts_listings.max()}")

# The first bin will be for hosts not in the top 1%, and the second for those in the top 1%
bins = [0, top_1_percent_threshold, top_1_percent_hosts_listings.max()]
bin_labels = ['99% of Hosts', '1% of Hosts']

# Bin the data
binned_counts = pd.cut(host_listing_counts_london, bins, labels=bin_labels)
binned_counts_value = binned_counts.value_counts().sort_index()

# Plot the percentage of the market controlled by the top 1% and the remaining 99%
market_share = host_listing_counts_london.groupby(binned_counts, observed=True).sum() / total_listings * 100
plt.figure(figsize=(10, 6))
market_share.plot(kind='bar', color='skyblue', edgecolor='black')
plt.xlabel('Host Groups')
plt.ylabel('Percentage of Total Listings')
plt.title('Market Share by Host Groups')
plt.xticks(rotation=0)
plt.tight_layout()
plt.show()

print(f"The top 1% of hosts control {percent_listings_top_1:.2f}% of the listings.")
```

To address this discrepancy the second method counts the frequency of each host_id and uses this value for the host listing count. Using this method we get figures inline with the reports from city hall in 2019, with a slight increase, 1% of hosts accounted for 17% of listings on Airbnb at the time of data collection. We can also see that 99% of hosts have less than 9 listings. 

However the spread within the top 1% is between 9 and 285 these hosts, are not comparable in terms of their scale of operation, thus it may be worth splitting the hosts further.



```{python}
# Identify hosts in each group based on your criteria
hosts_with_1_property = data[data['host_listings_group'] == '1 Property'].count()
print(hosts_with_1_property)
hosts_with_2_to_10_properties = data[data['host_listings_group'] == '2-10 Properties'].count()
print(hosts_with_2_to_10_properties)
hosts_with_11_to_100_properties = data[data['host_listings_group'] == '11-100 Properties'].count()
print(hosts_with_11_to_100_properties)
hosts_with_100_plus_properties = data[data['host_listings_group'] == '100+ Properties'].count()
print(hosts_with_100_plus_properties)
```

### 2. Number of properties in London listed on Airbnb

The total number of listings and in the dataset does not represent the number of whole property listings thus we can an estimate of just how many unique property listings there are.

The previous exploration highlighted that there is a mismatch between the host listings and the number of listings in the dataset, as such the calculated listings and host listings are not accurate columns to work from when working on data pertaining specifically to London.

```{python}
# Create a column combining latitude and longitude
data['coords'] = list(zip(data['latitude'], data['longitude']))

# Count the number of unique combinations of coordinates
unique_properties = data['coords'].nunique()

# Print the estimated number of unique properties
print(f"Estimated number of properties in London listed on Airbnb: {unique_properties}")
print(f"Number of listings in London on Airbnb: {len(data)}")

```

This method works out how many unique combinations there are of latitude and longitude there are within the Dataset. The result suggests that there are marginally lower unique properties that total listings on the platform, therefore the claim by Airbnb that the listings are inflated appears to be false.


### 3. The maximum number of nights legally allowed for short term rental in london is 90 days. How many listings are in breach of this limit?

```{python}
# Count listings with 'maximum_nights' over 90 days
listings_over_90_days_max_nights = (data['maximum_nights'] > 90).sum()

# Count listings with 'maximum_nights_avg_bookings' over 90 days
listings_over_90_days_avg_bookings = (data['maximum_nights_avg_bookings'] > 90).sum()

# Calculate percentages
percent_over_90_days_max_nights = (listings_over_90_days_max_nights / total_listings) * 100
percent_over_90_days_avg_bookings = (listings_over_90_days_avg_bookings / total_listings) * 100

# Print results
print(f"Listings with maximum nights over 90 days: {listings_over_90_days_max_nights}")
print(f"Percentage of listings with maximum nights over 90 days: {percent_over_90_days_max_nights:.2f}%")
print(f"Listings with average bookings over 90 days: {listings_over_90_days_avg_bookings}")
print(f"Percentage of listings with average bookings over 90 days: {percent_over_90_days_avg_bookings:.2f}%")

```

The data here suggests that approximately 2/3rds of listings are listed for over 90 days on the platform, and that 3/4s of the listings on the platform are on average booked for over 90 days. This seems to suggest that in 2022 the number of listings in breach of the 90 day limit was far over the 10,000 that was suggested by Temperton.

"More than 10,000 Airbnb listings in London are seemingly in breach of the city’s 90-day limit on short-term rentals, according to new research"

```{python}
# Ignore entries in 'maximum_nights_avg_bookings' over 1500 to remove anomalous results for legibility
max_night_avg_bookings_less_1500 = data[data['maximum_nights_avg_bookings'] <= 1500]

# Plot this data
sns.set(style="whitegrid")
plt.figure(figsize=(10, 6))
sns.histplot(max_night_avg_bookings_less_1500['maximum_nights_avg_bookings'], kde=True, bins=50)
plt.title('Distribution of Average Maximum Nights Booked')
plt.xlabel('Average Maximum Nights')
plt.ylabel('Frequency')

# Show the plot
plt.show()
```

The graphs first peak is at 10 days at about 10000. Roughly 17500 properties out of the total fall below the 90 day mark being, which is the cut off point for what s considered short term rental.

The next peak is at one year with approximately 9500 and the final and largest peak is at 3 years roughly being 38000.

This corroborates the claims that Airbnb and the short term rental market is being used as an alternative to the housing rental market.


### 4. Price per night, how much are people being charged on the platform?

```{python}
# Filter the data for listings with maximum nights over 90 days but less than 1500
long_term_listings = data[(data['maximum_nights_avg_bookings'] > 90) & (data['maximum_nights_avg_bookings'] < 1500)]

# Create the scatter plot
sns.set(style="whitegrid")
plt.figure(figsize=(12, 8))
sns.scatterplot(x=long_term_listings['maximum_nights_avg_bookings'], y=long_term_listings['price_per_night_£'])
plt.title('Price per Night vs. Average Maximum Nights for Bookings Over 90 Days')
plt.xlabel('Average Maximum Nights (Over 90 Days)')
plt.ylabel('Price per Night (£)')
plt.show()

# Calculate and print the mean and median price for the filtered listings
mean_price = long_term_listings['price_per_night_£'].mean()
median_price = long_term_listings['price_per_night_£'].median()

print(f'Mean price per night: £{mean_price:.2f}')

```

By mean average, it does seem to be more expensive to rent on Airbnb than it is to rent on the housing market. The average price per night for the rental housing market was £85.57 per night {cite}statista-london-rental, whereas the average price per night on Airbnb for the same time period was double that at £179.29 per night. 

Interestingly it also appears that the largest spread of prices is at the 3 year mark, with the most expensive listing per night being at this length of time.
